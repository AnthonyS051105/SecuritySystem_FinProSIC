# üîê Mini Security System dengan ESP32 & ESP32-CAM

Sistem keamanan sederhana menggunakan ESP32 sebagai controller utama dan ESP32-CAM sebagai modul kamera terpisah, dilengkapi sensor PIR untuk deteksi gerakan.

---

## üìê Arsitektur Sistem

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           ESP32 Dev Board (Main Controller)                ‚ïë
‚ïë  ‚Ä¢ Sensor PIR untuk deteksi gerakan                        ‚ïë
‚ïë  ‚Ä¢ LED indikator status                                    ‚ïë
‚ïë  ‚Ä¢ Switch untuk armed/disarmed                             ‚ïë
‚ïë  ‚Ä¢ WiFi untuk upload ke server                             ‚ïë
‚ïë  ‚Ä¢ Serial communication dengan ESP32-CAM                   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                     ‚ïë Serial UART
                     ‚ïë TX2 (GPIO17) ‚îÄ‚îÄ‚Üí RX (GPIO3)
                     ‚ïë RX2 (GPIO16) ‚Üê‚îÄ‚îÄ TX (GPIO1)
                     ‚ïë GND ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí GND
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           ESP32-CAM (Camera Module)                        ‚ïë
‚ïë  ‚Ä¢ Camera untuk capture image                              ‚ïë
‚ïë  ‚Ä¢ SD Card untuk backup (optional)                         ‚ïë
‚ïë  ‚Ä¢ Menerima perintah via Serial                            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## ‚ú® Fitur Utama

- ‚úÖ **Deteksi Gerakan:** Sensor PIR mendeteksi pergerakan
- ‚úÖ **Capture Foto:** ESP32-CAM mengambil foto berkualitas tinggi
- ‚úÖ **LED Indikator:** Visual feedback saat mendeteksi gerakan
- ‚úÖ **Armed/Disarmed Mode:** Switch untuk mengaktifkan/menonaktifkan sistem
- ‚úÖ **Upload ke Server:** Kirim foto via HTTP POST
- ‚úÖ **SD Card Backup:** Simpan foto di ESP32-CAM (optional)
- ‚úÖ **Serial Monitoring:** Status real-time di Serial Monitor
- ‚úÖ **Modular Design:** Controller dan kamera terpisah untuk fleksibilitas

---

## üõ†Ô∏è Komponen yang Dibutuhkan

### Hardware:

| Komponen             | Qty        | Keterangan             |
| -------------------- | ---------- | ---------------------- |
| ESP32 Dev Board      | 1          | Board utama/controller |
| ESP32-CAM AI Thinker | 1          | Modul kamera           |
| Sensor PIR HC-SR501  | 1          | Deteksi gerakan        |
| LED 5mm              | 1          | Indikator              |
| Resistor 220Œ©        | 1          | Untuk LED              |
| Push Button / Switch | 1          | Armed/Disarmed         |
| MicroSD Card         | 1          | Optional, untuk backup |
| Kabel Jumper         | secukupnya | Koneksi                |
| USB Cable            | 2          | Programming            |
| Power Supply 5V 2A   | 1-2        | Power board            |

### Software:

- PlatformIO IDE (VS Code extension)
- Arduino Framework
- Library: esp_camera, WiFi, HTTPClient, SD_MMC

---

## üîå Wiring Diagram

### ESP32 Dev Board Connections:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ESP32 Pin  ‚îÇ  Connect To                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  GPIO 13    ‚îÇ  PIR Sensor OUT             ‚îÇ
‚îÇ  GPIO 33    ‚îÇ  LED (+) via 220Œ© resistor  ‚îÇ
‚îÇ  GPIO 12    ‚îÇ  Switch (one side)          ‚îÇ
‚îÇ  GPIO 17    ‚îÇ  ESP32-CAM RX (GPIO3)       ‚îÇ
‚îÇ  GPIO 16    ‚îÇ  ESP32-CAM TX (GPIO1)       ‚îÇ
‚îÇ  GND        ‚îÇ  PIR GND, LED (-), Switch,  ‚îÇ
‚îÇ             ‚îÇ  ESP32-CAM GND              ‚îÇ
‚îÇ  5V/VIN     ‚îÇ  PIR VCC                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ESP32-CAM Connections:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ESP32-CAM   ‚îÇ  Connect To            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  GPIO 1 (TX) ‚îÇ  ESP32 GPIO 16 (RX2)   ‚îÇ
‚îÇ  GPIO 3 (RX) ‚îÇ  ESP32 GPIO 17 (TX2)   ‚îÇ
‚îÇ  GND         ‚îÇ  ESP32 GND (IMPORTANT!)‚îÇ
‚îÇ  5V          ‚îÇ  Power Supply 5V       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**‚ö†Ô∏è CRITICAL:** Pastikan GND kedua board terhubung untuk komunikasi Serial yang stabil!

---

## üöÄ Quick Start Guide

### Option 1: Menggunakan Helper Script (Recommended)

```bash
# Masuk ke direktori project
cd /home/anthony05/Coding/FinalProject_SIC

# Jalankan helper script
./setup.sh

# Pilih mode:
# 1 = Setup untuk programming ESP32-CAM
# 2 = Setup untuk programming ESP32 Controller
# 3 = Lihat status project
```

### Option 2: Manual Setup

#### Step 1: Upload ke ESP32-CAM

```bash
# Setup mode ESP32-CAM
./setup.sh esp32cam

# Atau manual:
cp src/esp32cam_slave.cpp.example src/main.cpp
# Edit platformio.ini -> board = esp32cam

# Hubungkan ESP32-CAM via FTDI (GPIO0 ke GND)
pio run --target upload

# Lepas GPIO0, tekan RESET di ESP32-CAM
```

#### Step 2: Upload ke ESP32 Controller

```bash
# Setup mode ESP32 Controller
./setup.sh esp32dev

# Edit WiFi credentials di src/main.cpp
# Edit server URL

# Hubungkan ESP32 via USB
pio run --target upload
```

#### Step 3: Wiring & Test

```bash
# Hubungkan hardware sesuai diagram
# Power on kedua board
# Monitor serial
pio device monitor
```

---

## ‚öôÔ∏è Konfigurasi

### WiFi Settings (di ESP32 Controller):

Edit file `src/main.cpp`:

```cpp
const char* ssid = "YOUR_WIFI_SSID";           // Ganti!
const char* password = "YOUR_WIFI_PASSWORD";   // Ganti!
const char* serverURL = "http://192.168.1.100:8080/upload"; // Ganti!
```

### Camera Settings (di ESP32-CAM):

Edit file `src/esp32cam_slave.cpp.example`:

```cpp
// Ubah resolusi
config.frame_size = FRAMESIZE_SVGA;   // 800x600 (recommended untuk Serial)
// atau
config.frame_size = FRAMESIZE_VGA;    // 640x480 (lebih cepat)

// Ubah kualitas JPEG (0-63, semakin kecil = kualitas lebih baik)
config.jpeg_quality = 12;
```

### PIR Cooldown (di ESP32 Controller):

```cpp
const unsigned long pirDebounceDelay = 5000; // 5 detik antara deteksi
```

---

## üìä Serial Monitor Output

```
========================================
  Mini Security System - ESP32 Controller
========================================

[INIT] Menginisialisasi pin GPIO...
[INIT] Pin GPIO berhasil diinisialisasi
[INIT] Menginisialisasi komunikasi dengan ESP32-CAM...
[INIT] ESP32-CAM berhasil terhubung!
[INIT] Menghubungkan ke WiFi...
[INIT] WiFi berhasil terhubung!
[INIT] IP Address: 192.168.1.100

========================================
  Sistem Siap!
========================================
[STATUS] System Armed - Monitoring aktif
[STATUS] WiFi Connected - IP: 192.168.1.100
[STATUS] Images captured: 0

[STATUS] Monitoring...

========================================
[ALERT] Motion Detected!
========================================
[ACTION] LED indikator dihidupkan
[CAMERA] Mengirim perintah ke ESP32-CAM untuk mengambil foto...
[CAMERA] ESP32-CAM siap mengirim data gambar
[CAMERA] Menerima data gambar dari ESP32-CAM...
[CAMERA] Ukuran gambar: 15420 bytes
[CAMERA] Berhasil menerima 15420 bytes data gambar
[SUCCESS] Image Captured
[HTTP] Mengirim foto ke server...
[HTTP] Response code: 200
[HTTP] Response: {"status":"success"}
[ACTION] LED indikator dimatikan
========================================
```

---

## üêõ Troubleshooting

### Problem: ESP32-CAM tidak merespons

**Solution:**

- Cek koneksi TX/RX (mungkin terbalik)
- Pastikan GND terhubung antara kedua board
- Cek power supply ESP32-CAM (min 5V 2A)
- Re-upload program ke ESP32-CAM

### Problem: Timeout menerima data gambar

**Solution:**

- Ukuran gambar terlalu besar untuk Serial
- Edit ESP32-CAM: ubah `FRAMESIZE_SVGA` ‚Üí `FRAMESIZE_VGA`
- Atau edit buffer size di controller

### Problem: WiFi gagal terhubung

**Solution:**

- Cek SSID dan password (case-sensitive)
- Pastikan WiFi 2.4GHz (ESP32 tidak support 5GHz)
- Dekatkan ESP32 ke router
- Restart router

### Problem: PIR tidak mendeteksi

**Solution:**

- Tunggu 30-60 detik setelah power on (warming up)
- Cek koneksi VCC, GND, OUT
- Adjust sensitivity potentiometer di PIR sensor
- Test dengan gerakan tangan di depan sensor

### Problem: LED tidak menyala

**Solution:**

- Cek polaritas LED (kaki panjang = anode/+)
- Pastikan resistor 220Œ© terpasang
- Test LED dengan multimeter
- Cek koneksi ke GPIO 33

---

## üì° Protokol Komunikasi

### Command Protocol:

| Command     | Response            | Description                  |
| ----------- | ------------------- | ---------------------------- |
| `TEST\n`    | `READY\n`           | Test koneksi ESP32-CAM       |
| `CAPTURE\n` | `OK\n` + image data | Request capture & send image |

### Image Data Format:

```
OK\n
SIZE:12345\n
[binary JPEG data 12345 bytes]
```

---

## üìÅ File Structure

```
FinalProject_SIC/
‚îÇ
‚îú‚îÄ‚îÄ platformio.ini                      # PlatformIO configuration
‚îú‚îÄ‚îÄ setup.sh                            # Helper script untuk switching mode
‚îú‚îÄ‚îÄ SETUP_GUIDE.md                      # Detailed setup guide
‚îú‚îÄ‚îÄ README.md                           # This file
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp                        # Active code (ESP32 atau ESP32-CAM)
‚îÇ   ‚îú‚îÄ‚îÄ esp32cam_slave.cpp.example      # ESP32-CAM slave code
‚îÇ   ‚îú‚îÄ‚îÄ main_esp32_controller.cpp.backup # Backup ESP32 controller
‚îÇ   ‚îî‚îÄ‚îÄ main_esp32cam.cpp.backup        # Backup ESP32-CAM
‚îÇ
‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îî‚îÄ‚îÄ README
‚îÇ
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ README
‚îÇ
‚îî‚îÄ‚îÄ test/
    ‚îî‚îÄ‚îÄ README
```

---

## üéØ Usage Checklist

Sebelum menjalankan sistem, pastikan:

- [ ] ESP32-CAM sudah diprogram dengan kode slave
- [ ] ESP32 Controller sudah diprogram dengan kode controller
- [ ] WiFi credentials sudah dikonfigurasi
- [ ] Server URL sudah dikonfigurasi
- [ ] Koneksi Serial TX/RX sudah benar (TX‚ÜíRX, RX‚ÜíTX)
- [ ] GND kedua board terhubung
- [ ] PIR Sensor terhubung ke ESP32 (GPIO 13)
- [ ] LED terhubung ke ESP32 (GPIO 33)
- [ ] Switch terhubung ke ESP32 (GPIO 12)
- [ ] Power supply mencukupi (min 5V 2A untuk ESP32-CAM)
- [ ] Serial Monitor menunjukkan "ESP32-CAM berhasil terhubung"
- [ ] Test motion detection berhasil

---

## üîß Development Commands

```bash
# Build project
pio run

# Upload ke board
pio run --target upload

# Upload dan langsung monitor
pio run --target upload --target monitor

# Monitor serial saja
pio device monitor

# Clean build
pio run --target clean

# Check status dengan helper script
./setup.sh status
```

---

## üìö Documentation

- [SETUP_GUIDE.md](./SETUP_GUIDE.md) - Detailed setup instructions
- [PlatformIO Docs](https://docs.platformio.org/)
- [ESP32-CAM Pinout](https://randomnerdtutorials.com/esp32-cam-ai-thinker-pinout/)
- [ESP32 Pinout](https://randomnerdtutorials.com/esp32-pinout-reference-gpios/)

---

## ü§ù Contributing

Feel free to fork this project and submit pull requests for improvements!

---

## üìÑ License

This project is open source and available under the MIT License.

---

## üë®‚Äçüíª Author

**Security System Project**  
Final Project SIC  
October 2025

---

## üôè Acknowledgments

- ESP32 Community
- Arduino Framework
- PlatformIO

---

**Happy Coding! üöÄ**
